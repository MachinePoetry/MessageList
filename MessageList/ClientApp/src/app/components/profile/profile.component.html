<noscript>
  <div class="panel panel-default">
    <div class="panel-heading text-center">
      <h3>Упс! Что-то пошло не так!</h3>
    </div>
    <div class="panel-body text-center">
      <h5>Ваш браузер не обрабатывает JavaScript</h5>
      <h5>Зайдите в настройки браузера и включите обработку скриптов</h5>
    </div>
  </div>
</noscript>

<app-header [authUserInfo]="authUserInfo"></app-header>

<app-toasts class="toasts-container"></app-toasts>

<div class="container-fliud">
  <div class="container profile-container">
    <div class="row mt-5">
      <div class="col-12 col-lg-10 offset-lg-1 profile-panel round-border-top">
        <h1 class="text-center">Профиль</h1>
      </div>
      <div class="col-12 col-lg-10 offset-lg-1 profile-content">
        <div class="row align-items-center">
          <div class="col-5 col-sm-7"><p class="mt-5 ml-sm-2 ml-md-5" id="serverUptimeLabel"> Аптайм сервера: </p></div>
          <div class="col-7 col-sm-5"><p class="mt-5 text-success" id="serverUptime"> {{uptime | secondsToTime: 'uptime' || 'Загрузка...'}} </p></div>
        </div>
        <div class="row align-items-center">
          <div class="col-12 col-lg-10 offset-lg-1">
            <h4 class="mt-3 text-center">Личные данные:</h4>
          </div>
        </div>
        <div class="row align-items-center">
          <div class="col-5 col-sm-7"><p class="mt-4 ml-sm-2 ml-md-5" id="authUserEmailLabel"> Email: </p></div>
          <div class="col-7 col-sm-5"><p class="mt-4 text-danger text-break" id="authUserEmail"> {{authUserInfo?.email || 'Загрузка...'}} </p> </div>
        </div>
        <div class="row align-items-center">
          <div class="col-5 col-sm-7"><p class="mt-3 ml-sm-2 ml-md-5" id="userCreatedAtLabel"> Дата регистрации: </p></div>
          <div class="col-7 col-sm-5"><p class="mt-3 text-success" id="userCreatedAt"> {{authUserInfo?.createdAt | dateToLocale: 'ru' || 'Загрузка...'}} </p></div>
        </div>
        <div class="row align-items-center">
          <div class="col-5 col-sm-7">
            <p class="mt-2 ml-sm-2 ml-md-5" id="loadedMessagesAmountLabel"> Количество единовременно загружаемых сообщений: </p>
          </div>
          <div class="col-7 col-sm-5"><p class="mt-3 text-success"> {{(authUserInfo?.messagesToLoadAmount === 0 ? 'Все' : authUserInfo?.messagesToLoadAmount) || 'Загрузка...'}} </p></div>
        </div>
        <div class="row align-items-center">
          <div class="col-12 col-lg-10 offset-lg-1">
            <h4 class="mt-3 text-center">Изменение личных данных:</h4>
          </div>
        </div>
        <div class="row align-items-center">
          <div class="col-5 col-sm-7">
            <p class="mt-4 ml-sm-2 ml-md-5" id="changeLoadedMessagesAmountLabel">
              Изменить количество единовременно загружаемых сообщений
              <i class="mdi mdi-lg mdi-help-circle-outline" placement="top" ngbTooltip="Укажите новое количество единовременно загружаемых сообщений.&#10;Минимум 20, максимум 10000">
              </i> :
            </p>
          </div>
          <div class="col-7 col-sm-5">
            <div class="d-flex align-items-center w-100 mt-4">
              <form #messagesToLoadForm="ngForm" id="messagesToLoadForm" (ngSubmit)="onMessagesToLoadFormSubmit(messagesToLoadForm)" novalidate>
                <input type="number" #messagesToLoad="ngModel" class="form-control" id="messagesToLoadCount" name="messagesToLoadCount"
                       [ngClass]="{'submit-error': messagesToLoadForm.submitted && !messagesToLoadForm.control.disabled && (messagesToLoadAmount < 20 || messagesToLoadAmount > 10000)}"
                       [(ngModel)]="messagesToLoadAmount" required min="20" max="10000" [disabled]="loadAllMessages">
              </form>
              <button type="submit" class="btn dark-login-button ml-2 ml-sm-3" form="messagesToLoadForm" id="messagesToLoadFormButton">
                <span class="dark-color-text"> Сохранить </span>
              </button>
            </div>
            <div class="d-flex align-items-center w-90 ml-4">
              <input type="checkbox" class="form-check-input mt-1" name="loadAllMessages" [(ngModel)]="loadAllMessages">
              <span class="lh-1 mt-1 mt-sm-0" (click)="loadAllMessages = !loadAllMessages" id="loadAllMessagesLabel"> Загружать все </span>
            </div>
          </div>
        </div>
        <div class="row align-items-center">
          <div class="col-7 col-sm-5">
            <form #changePasswordForm="ngForm" class="w-100 ml-sm-2 ml-md-5 mb-5" id="changePasswordForm" (ngSubmit)="onChangePasswordFormSubmit(changePasswordForm)" novalidate>
              <label for="oldPassword" class="mt-2"> Введите старый пароль: </label>
              <input #oldPassword="ngModel" class="form-control" [ngClass]="{'submit-error': changePasswordForm.submitted}" type="password" name="oldPassword" id="oldPassword"
                      placeholder="Введите старый пароль" [(ngModel)]="changePasswordParams.oldPassword" required pattern="^.{1,20}$" minlength="4" maxlength="21">
              <div class="justify-content-center">
                <div *ngIf="oldPassword.invalid && (oldPassword.touched || oldPassword.dirty || changePasswordForm.submitted)">
                  <div *ngIf="oldPassword.errors?.required">
                    <span class="alert-text small">Введите старый пароль</span>
                  </div>
                  <div *ngIf="oldPassword.errors?.minlength">
                    <span class="alert-text small">Допустимая длина пароля не менее 4 символов</span>
                  </div>
                  <div *ngIf="oldPassword.errors?.pattern">
                    <span class="alert-text small">Допустимая длина пароля не более 20 символов</span>
                  </div>
                </div>
              </div>
              <label for="newPassword" class="mt-2"> Введите новый пароль: </label>
              <input #newPassword="ngModel" class="form-control" [ngClass]="{'submit-error': changePasswordForm.submitted}" type="password" name="newPassword" id="newPassword"
                      placeholder="Введите новый пароль" [(ngModel)]="changePasswordParams.newPassword" required pattern="^.{1,20}$" minlength="4" maxlength="21"
                      validateEqual=”confirmNewPassword” errorToTargetControl=”true” />
              <div class="justify-content-center">
                <div *ngIf="newPassword.invalid && (newPassword.touched || newPassword.dirty || changePasswordForm.submitted)">
                  <div *ngIf="newPassword.errors?.required">
                    <span class="alert-text small">Введите новый пароль</span>
                  </div>
                  <div *ngIf="newPassword.errors?.minlength">
                    <span class="alert-text small">Допустимая длина пароля не менее 4 символов</span>
                  </div>
                  <div *ngIf="newPassword.errors?.pattern">
                    <span class="alert-text small">Допустимая длина пароля не более 20 символов</span>
                  </div>
                </div>
              </div>
              <label for="confirmNewPassword" class="mt-2"> Введите новый пароль еще раз: </label>
              <input #confirmNewPassword="ngModel" class="form-control" [ngClass]="{'submit-error': changePasswordForm.submitted}" type="password" name="confirmNewPassword"
                      id="confirmNewPassword" placeholder="Введите новый пароль еще раз" [(ngModel)]="changePasswordParams.confirmNewPassword" required pattern="^.{1,20}$"
                      minlength="4" maxlength="21" validateEqual=”newPassword” />
              <div class="justify-content-center">
                <div *ngIf="confirmNewPassword.invalid && (confirmNewPassword.touched || confirmNewPassword.dirty || changePasswordForm.submitted)">
                  <div *ngIf="confirmNewPassword.errors?.required">
                    <span class="alert-text small">Введите новый пароль еще раз</span>
                  </div>
                  <div *ngIf="confirmNewPassword.errors?.minlength">
                    <span class="alert-text small">Допустимая длина пароля не менее 4 символов</span>
                  </div>
                  <div *ngIf="confirmNewPassword.errors?.validateNotEqual">
                    <span class="alert-text small"> Пароли не совпадают </span>
                  </div>
                  <div *ngIf="confirmNewPassword.errors?.pattern">
                    <span class="alert-text small">Допустимая длина пароля не более 20 символов</span>
                  </div>
                </div>
              </div>
              <button type="submit" class="btn dark-login-button mt-4" id="changePasswordFormButton" [disabled]="isPasswordChanging">
                <span class="dark-color-text"> Сохранить </span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
